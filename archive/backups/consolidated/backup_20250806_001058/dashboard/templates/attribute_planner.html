<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attribute Planner - Build Optimizer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .build-card {
            transition: transform 0.2s;
            border-left: 4px solid #007bff;
        }
        .build-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .armor-slot {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .stat-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin: 2px;
        }
        .resistance-badge {
            background: #fff3e0;
            color: #f57c00;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin: 2px;
        }
        .buff-card {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
        }
        .effectiveness-score {
            font-size: 1.2em;
            font-weight: bold;
        }
        .score-excellent { color: #28a745; }
        .score-good { color: #17a2b8; }
        .score-average { color: #ffc107; }
        .score-poor { color: #dc3545; }
        .form-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .recommendation-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        .attribute-effect {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .weapon-type-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row bg-primary text-white p-3 mb-4">
            <div class="col">
                <h1><i class="bi bi-gear-wide-connected"></i> Attribute Planner</h1>
                <p class="mb-0">Build-aware recommendations using SWG attribute effects</p>
            </div>
        </div>

        <div class="row">
            <!-- Build Configuration Form -->
            <div class="col-md-4">
                <div class="form-section">
                    <h4><i class="bi bi-sliders"></i> Build Configuration</h4>
                    
                    <form id="build-form">
                        <div class="mb-3">
                            <label for="build-name" class="form-label">Build Name</label>
                            <input type="text" class="form-control" id="build-name" 
                                   placeholder="e.g., Rifleman Medic" value="Rifleman Medic">
                        </div>
                        
                        <div class="mb-3">
                            <label for="weapon-type" class="form-label">Weapon Type</label>
                            <select class="form-select" id="weapon-type">
                                <option value="ranged">Ranged</option>
                                <option value="melee">Melee</option>
                                <option value="pistol">Pistol</option>
                                <option value="rifle">Rifle</option>
                                <option value="carbine">Carbine</option>
                                <option value="heavy_weapon">Heavy Weapon</option>
                                <option value="light_saber">Light Saber</option>
                                <option value="vibro_blade">Vibro Blade</option>
                                <option value="unarmed">Unarmed</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="combat-role" class="form-label">Combat Role</label>
                            <select class="form-select" id="combat-role">
                                <option value="tank">Tank</option>
                                <option value="dps">DPS</option>
                                <option value="healer">Healer</option>
                                <option value="support">Support</option>
                                <option value="hybrid">Hybrid</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Resistance Focus (Optional)</label>
                            <div class="row">
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="kinetic" id="res-kinetic">
                                        <label class="form-check-label" for="res-kinetic">Kinetic</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="energy" id="res-energy">
                                        <label class="form-check-label" for="res-energy">Energy</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="blast" id="res-blast">
                                        <label class="form-check-label" for="res-blast">Blast</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="heat" id="res-heat">
                                        <label class="form-check-label" for="res-heat">Heat</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="cold" id="res-cold">
                                        <label class="form-check-label" for="res-cold">Cold</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="electricity" id="res-electricity">
                                        <label class="form-check-label" for="res-electricity">Electricity</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="acid" id="res-acid">
                                        <label class="form-check-label" for="res-acid">Acid</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="stun" id="res-stun">
                                        <label class="form-check-label" for="res-stun">Stun</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-magic"></i> Generate Build Optimization
                        </button>
                    </form>
                </div>
                
                <!-- Attribute Effects Info -->
                <div class="form-section">
                    <h5><i class="bi bi-info-circle"></i> Attribute Effects</h5>
                    <div id="attribute-effects">
                        <div class="attribute-effect">
                            <strong>Strength:</strong> Increases melee weapon damage
                        </div>
                        <div class="attribute-effect">
                            <strong>Constitution:</strong> Increases kinetic resistance and health
                        </div>
                        <div class="attribute-effect">
                            <strong>Precision:</strong> Increases ranged weapon accuracy
                        </div>
                        <div class="attribute-effect">
                            <strong>Agility:</strong> Increases dodge chance and movement speed
                        </div>
                        <div class="attribute-effect">
                            <strong>Stamina:</strong> Increases maximum health and health regeneration
                        </div>
                        <div class="attribute-effect">
                            <strong>Mind:</strong> Increases healing effectiveness and force power
                        </div>
                        <div class="attribute-effect">
                            <strong>Focus:</strong> Increases critical hit chance and mental resistance
                        </div>
                        <div class="attribute-effect">
                            <strong>Willpower:</strong> Increases mental resistance and force defense
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Build Recommendations -->
            <div class="col-md-8">
                <div id="loading" class="loading" style="display: none;">
                    <i class="bi bi-arrow-clockwise spin"></i>
                    <p>Generating build optimization...</p>
                </div>
                
                <div id="build-recommendations">
                    <div class="text-center text-muted">
                        <i class="bi bi-gear" style="font-size: 3em;"></i>
                        <p>Configure your build and click "Generate Build Optimization" to get recommendations</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentOptimization = null;
        
        document.getElementById('build-form').addEventListener('submit', function(e) {
            e.preventDefault();
            generateOptimization();
        });
        
        function generateOptimization() {
            const buildName = document.getElementById('build-name').value;
            const weaponType = document.getElementById('weapon-type').value;
            const combatRole = document.getElementById('combat-role').value;
            
            // Get selected resistances
            const resistanceTypes = [];
            const resistanceCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            resistanceCheckboxes.forEach(checkbox => {
                resistanceTypes.push(checkbox.value);
            });
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('build-recommendations').innerHTML = '';
            
            // Make API call
            fetch('/api/attribute-optimizer/optimize', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    build_name: buildName,
                    weapon_type: weaponType,
                    combat_role: combatRole,
                    resistance_focus: resistanceTypes
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentOptimization = data.optimization;
                    displayOptimization(data.optimization);
                } else {
                    showError(data.error || 'Failed to generate optimization');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showError('Failed to connect to server');
            })
            .finally(() => {
                document.getElementById('loading').style.display = 'none';
            });
        }
        
        function displayOptimization(optimization) {
            const container = document.getElementById('build-recommendations');
            
            const effectivenessClass = getEffectivenessClass(optimization.armor_recommendation.effectiveness_score);
            
            container.innerHTML = `
                <div class="recommendation-section">
                    <div class="row">
                        <div class="col-md-8">
                            <h3><i class="bi bi-shield-check"></i> ${optimization.build_name}</h3>
                            <p class="text-muted">${optimization.notes}</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="effectiveness-score ${effectivenessClass}">
                                ${Math.round(optimization.armor_recommendation.effectiveness_score * 100)}% Effective
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h5><i class="bi bi-tag"></i> Primary Attributes</h5>
                            <div>
                                ${optimization.armor_recommendation.primary_stats.map(stat => 
                                    `<span class="stat-badge">${stat}</span>`
                                ).join('')}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5><i class="bi bi-shield"></i> Resistance Focus</h5>
                            <div>
                                ${optimization.armor_recommendation.resistance_priorities.map(res => 
                                    `<span class="resistance-badge">${res}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Armor Recommendations -->
                <div class="recommendation-section">
                    <h4><i class="bi bi-shield"></i> Armor Recommendations</h4>
                    <p>${optimization.armor_recommendation.reasoning}</p>
                    
                    <div class="row">
                        ${Object.entries(optimization.armor_recommendation.armor_slots).map(([slot, data]) => `
                            <div class="col-md-6 mb-3">
                                <div class="armor-slot">
                                    <h6><i class="bi bi-box"></i> ${slot.charAt(0).toUpperCase() + slot.slice(1)}</h6>
                                    <div class="mb-2">
                                        <strong>Primary Stats:</strong>
                                        ${data.primary_stats.map(stat => `<span class="stat-badge">${stat}</span>`).join('')}
                                    </div>
                                    <div class="mb-2">
                                        <strong>Secondary Stats:</strong>
                                        ${data.secondary_stats.map(stat => `<span class="stat-badge">${stat}</span>`).join('')}
                                    </div>
                                    <div class="mb-2">
                                        <strong>Resistances:</strong>
                                        ${data.resistances.map(res => `<span class="resistance-badge">${res}</span>`).join('')}
                                    </div>
                                    ${data.special ? `<div><strong>Special:</strong> <span class="stat-badge">${data.special}</span></div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Buff Recommendations -->
                <div class="recommendation-section">
                    <h4><i class="bi bi-cup-hot"></i> Buff Recommendations</h4>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h5><i class="bi bi-egg-fried"></i> Food Buffs</h5>
                            ${optimization.food_recommendations.map(buff => `
                                <div class="buff-card">
                                    <h6>${buff.buff_name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h6>
                                    <p><strong>Effect:</strong> ${buff.primary_effect}</p>
                                    <p><strong>Duration:</strong> ${buff.duration} minutes</p>
                                    <p><strong>Cost:</strong> ~${buff.cost_estimate} credits</p>
                                    <span class="badge bg-success">${buff.availability}</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="col-md-6">
                            <h5><i class="bi bi-droplet"></i> Medicine/Stims</h5>
                            ${optimization.buff_recommendations.map(buff => `
                                <div class="buff-card">
                                    <h6>${buff.buff_name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</h6>
                                    <p><strong>Effect:</strong> ${buff.primary_effect}</p>
                                    <p><strong>Duration:</strong> ${buff.duration} minutes</p>
                                    <p><strong>Cost:</strong> ~${buff.cost_estimate} credits</p>
                                    <span class="badge bg-warning">${buff.availability}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                
                <!-- Build Summary -->
                <div class="recommendation-section">
                    <h4><i class="bi bi-clipboard-data"></i> Build Summary</h4>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>Weapon Type</h6>
                                <p><i class="bi bi-crosshair"></i> ${optimization.weapon_type.replace(/_/g, ' ')}</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>Combat Role</h6>
                                <p><i class="bi bi-person-badge"></i> ${optimization.combat_role}</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>Overall Score</h6>
                                <p class="effectiveness-score ${effectivenessClass}">${Math.round(optimization.overall_score * 100)}%</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>Total Buffs</h6>
                                <p><i class="bi bi-plus-circle"></i> ${optimization.buff_recommendations.length + optimization.food_recommendations.length}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getEffectivenessClass(score) {
            if (score >= 0.8) return 'score-excellent';
            if (score >= 0.6) return 'score-good';
            if (score >= 0.4) return 'score-average';
            return 'score-poor';
        }
        
        function showError(message) {
            document.getElementById('build-recommendations').innerHTML = `
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle"></i> ${message}
                </div>
            `;
        }
        
        // Add spinning animation
        const style = document.createElement('style');
        style.textContent = `
            .spin {
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html> 