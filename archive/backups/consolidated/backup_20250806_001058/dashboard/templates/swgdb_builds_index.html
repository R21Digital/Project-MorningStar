<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWG Armory - Player Builds</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .main-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin: 20px auto;
            max-width: 1400px;
            overflow: hidden;
        }

        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header-section p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-section {
            padding: 30px;
            background: var(--light-color);
        }

        .search-form {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .search-form h3 {
            color: var(--dark-color);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            outline: none;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .builds-section {
            padding: 30px;
        }

        .builds-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .builds-header h3 {
            color: var(--dark-color);
            font-weight: 600;
            margin: 0;
        }

        .builds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .build-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .build-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: var(--primary-color);
        }

        .build-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .build-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-color);
            margin: 0;
        }

        .build-rankings {
            display: flex;
            gap: 5px;
        }

        .ranking-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .ranking-top-dps {
            background: #ff6b6b;
            color: white;
        }

        .ranking-buff-bot {
            background: #4ecdc4;
            color: white;
        }

        .ranking-tank {
            background: #45b7d1;
            color: white;
        }

        .ranking-versatile {
            background: #96ceb4;
            color: white;
        }

        .ranking-community {
            background: #feca57;
            color: white;
        }

        .build-info {
            margin-bottom: 15px;
        }

        .build-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .build-info-label {
            color: var(--secondary-color);
            font-weight: 600;
        }

        .build-info-value {
            color: var(--dark-color);
        }

        .build-summary {
            color: var(--secondary-color);
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .build-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--secondary-color);
            text-transform: uppercase;
        }

        .build-actions {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--secondary-color);
        }

        .no-builds {
            text-align: center;
            padding: 40px;
            color: var(--secondary-color);
        }

        .filters-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .filter-tag {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-tag.active {
            background: var(--primary-color);
            color: white;
        }

        .filter-tag.inactive {
            background: var(--light-color);
            color: var(--secondary-color);
        }

        .filter-tag:hover {
            transform: translateY(-1px);
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .page-link {
            padding: 8px 12px;
            margin: 0 2px;
            border-radius: 6px;
            text-decoration: none;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .page-link:hover {
            background: var(--primary-color);
            color: white;
        }

        .page-link.active {
            background: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header-section">
            <h1><i class="fas fa-shield-alt"></i> SWG Armory</h1>
            <p>Browse and discover the best player builds in the galaxy</p>
        </div>

        <div class="search-section">
            <div class="search-form">
                <h3><i class="fas fa-search"></i> Search Builds</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="searchQuery">Search</label>
                        <input type="text" id="searchQuery" class="form-control" placeholder="Search builds...">
                    </div>
                    <div class="form-group">
                        <label for="professionFilter">Profession</label>
                        <select id="professionFilter" class="form-control">
                            <option value="">All Professions</option>
                            <option value="rifleman">Rifleman</option>
                            <option value="pistoleer">Pistoleer</option>
                            <option value="carbineer">Carbineer</option>
                            <option value="medic">Medic</option>
                            <option value="scout">Scout</option>
                            <option value="brawler">Brawler</option>
                            <option value="entertainer">Entertainer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="damageTypeFilter">Damage Type</label>
                        <select id="damageTypeFilter" class="form-control">
                            <option value="">All Types</option>
                            <option value="kinetic">Kinetic</option>
                            <option value="energy">Energy</option>
                            <option value="blast">Blast</option>
                            <option value="heat">Heat</option>
                            <option value="cold">Cold</option>
                            <option value="electricity">Electricity</option>
                            <option value="acid">Acid</option>
                            <option value="stun">Stun</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="factionFilter">Faction</label>
                        <select id="factionFilter" class="form-control">
                            <option value="">All Factions</option>
                            <option value="rebel">Rebel</option>
                            <option value="imperial">Imperial</option>
                            <option value="neutral">Neutral</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="pvePvpFilter">Focus</label>
                        <select id="pvePvpFilter" class="form-control">
                            <option value="">All Focus</option>
                            <option value="pve">PvE</option>
                            <option value="pvp">PvP</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="minGcwRankFilter">Min GCW Rank</label>
                        <input type="number" id="minGcwRankFilter" class="form-control" min="0" max="25" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label for="tagsFilter">Tags</label>
                        <input type="text" id="tagsFilter" class="form-control" placeholder="Enter tags (comma separated)">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <div>
                            <button type="button" id="searchBtn" class="btn btn-primary">
                                <i class="fas fa-search"></i> Search
                            </button>
                            <button type="button" id="clearBtn" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="filters-section">
                <h4><i class="fas fa-filter"></i> Quick Filters</h4>
                <div class="filter-tags">
                    <span class="filter-tag active" data-ranking="top_dps">Top DPS</span>
                    <span class="filter-tag inactive" data-ranking="popular_buff_bot">Buff Bot</span>
                    <span class="filter-tag inactive" data-ranking="best_tank">Best Tank</span>
                    <span class="filter-tag inactive" data-ranking="most_versatile">Most Versatile</span>
                    <span class="filter-tag inactive" data-ranking="community_choice">Community Choice</span>
                </div>
            </div>
        </div>

        <div class="builds-section">
            <div class="builds-header">
                <h3><i class="fas fa-list"></i> Player Builds</h3>
                <div>
                    <span id="buildCount" class="text-muted">0 builds found</span>
                </div>
            </div>

            <div id="buildsContainer">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> Loading builds...
                </div>
            </div>

            <div id="pagination" class="pagination" style="display: none;">
                <!-- Pagination will be generated here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class BuildBrowser {
            constructor() {
                this.builds = [];
                this.filteredBuilds = [];
                this.currentPage = 1;
                this.buildsPerPage = 12;
                this.currentFilters = {};
                this.currentRanking = null;
                
                this.initializeEventListeners();
                this.loadBuilds();
            }

            initializeEventListeners() {
                // Search button
                document.getElementById('searchBtn').addEventListener('click', () => {
                    this.applyFilters();
                });

                // Clear button
                document.getElementById('clearBtn').addEventListener('click', () => {
                    this.clearFilters();
                });

                // Filter tags
                document.querySelectorAll('.filter-tag').forEach(tag => {
                    tag.addEventListener('click', (e) => {
                        this.toggleRankingFilter(e.target.dataset.ranking);
                    });
                });

                // Enter key on search input
                document.getElementById('searchQuery').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.applyFilters();
                    }
                });
            }

            async loadBuilds() {
                try {
                    const response = await fetch('/api/public-builds');
                    const data = await response.json();
                    
                    if (data.success) {
                        this.builds = data.builds;
                        this.filteredBuilds = [...this.builds];
                        this.renderBuilds();
                        this.updateBuildCount();
                    } else {
                        this.showError('Failed to load builds: ' + data.error);
                    }
                } catch (error) {
                    this.showError('Failed to load builds: ' + error.message);
                }
            }

            applyFilters() {
                const query = document.getElementById('searchQuery').value;
                const profession = document.getElementById('professionFilter').value;
                const damageType = document.getElementById('damageTypeFilter').value;
                const faction = document.getElementById('factionFilter').value;
                const pvePvp = document.getElementById('pvePvpFilter').value;
                const minGcwRank = document.getElementById('minGcwRankFilter').value;
                const tags = document.getElementById('tagsFilter').value;

                this.currentFilters = {
                    query: query || undefined,
                    profession: profession || undefined,
                    damage_type: damageType || undefined,
                    faction: faction || undefined,
                    pve_pvp: pvePvp || undefined,
                    min_gcw_rank: minGcwRank ? parseInt(minGcwRank) : undefined,
                    tags: tags ? tags.split(',').map(t => t.trim()) : undefined
                };

                this.searchBuilds();
            }

            async searchBuilds() {
                try {
                    const params = new URLSearchParams();
                    Object.entries(this.currentFilters).forEach(([key, value]) => {
                        if (value !== undefined) {
                            if (Array.isArray(value)) {
                                value.forEach(v => params.append(key, v));
                            } else {
                                params.append(key, value);
                            }
                        }
                    });

                    const response = await fetch(`/api/public-builds/search?${params.toString()}`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.filteredBuilds = data.builds;
                        this.currentPage = 1;
                        this.renderBuilds();
                        this.updateBuildCount();
                    } else {
                        this.showError('Search failed: ' + data.error);
                    }
                } catch (error) {
                    this.showError('Search failed: ' + error.message);
                }
            }

            async toggleRankingFilter(rankingType) {
                const tags = document.querySelectorAll('.filter-tag');
                
                if (this.currentRanking === rankingType) {
                    // Remove ranking filter
                    this.currentRanking = null;
                    tags.forEach(tag => {
                        tag.classList.remove('active');
                        tag.classList.add('inactive');
                    });
                    tags[0].classList.add('active'); // Reset to "All"
                } else {
                    // Apply ranking filter
                    this.currentRanking = rankingType;
                    tags.forEach(tag => {
                        tag.classList.remove('active');
                        tag.classList.add('inactive');
                    });
                    document.querySelector(`[data-ranking="${rankingType}"]`).classList.add('active');
                }

                if (this.currentRanking) {
                    await this.loadTopBuilds(rankingType);
                } else {
                    this.filteredBuilds = [...this.builds];
                    this.renderBuilds();
                    this.updateBuildCount();
                }
            }

            async loadTopBuilds(rankingType) {
                try {
                    const response = await fetch(`/api/public-builds/top/${rankingType}?limit=50`);
                    const data = await response.json();
                    
                    if (data.success) {
                        this.filteredBuilds = data.builds;
                        this.currentPage = 1;
                        this.renderBuilds();
                        this.updateBuildCount();
                    } else {
                        this.showError('Failed to load top builds: ' + data.error);
                    }
                } catch (error) {
                    this.showError('Failed to load top builds: ' + error.message);
                }
            }

            clearFilters() {
                document.getElementById('searchQuery').value = '';
                document.getElementById('professionFilter').value = '';
                document.getElementById('damageTypeFilter').value = '';
                document.getElementById('factionFilter').value = '';
                document.getElementById('pvePvpFilter').value = '';
                document.getElementById('minGcwRankFilter').value = '';
                document.getElementById('tagsFilter').value = '';

                // Reset ranking filter
                this.currentRanking = null;
                document.querySelectorAll('.filter-tag').forEach(tag => {
                    tag.classList.remove('active');
                    tag.classList.add('inactive');
                });
                document.querySelectorAll('.filter-tag')[0].classList.add('active');

                this.currentFilters = {};
                this.filteredBuilds = [...this.builds];
                this.currentPage = 1;
                this.renderBuilds();
                this.updateBuildCount();
            }

            renderBuilds() {
                const container = document.getElementById('buildsContainer');
                const startIndex = (this.currentPage - 1) * this.buildsPerPage;
                const endIndex = startIndex + this.buildsPerPage;
                const pageBuilds = this.filteredBuilds.slice(startIndex, endIndex);

                if (pageBuilds.length === 0) {
                    container.innerHTML = `
                        <div class="no-builds">
                            <i class="fas fa-search"></i>
                            <h4>No builds found</h4>
                            <p>Try adjusting your search criteria or filters.</p>
                        </div>
                    `;
                    document.getElementById('pagination').style.display = 'none';
                    return;
                }

                const buildsHtml = pageBuilds.map(build => this.renderBuildCard(build)).join('');
                container.innerHTML = `
                    <div class="builds-grid">
                        ${buildsHtml}
                    </div>
                `;

                this.renderPagination();
            }

            renderBuildCard(build) {
                const rankingsHtml = build.rankings.map(ranking => {
                    const rankingClass = this.getRankingClass(ranking);
                    const rankingText = this.getRankingText(ranking);
                    return `<span class="ranking-badge ${rankingClass}">${rankingText}</span>`;
                }).join('');

                const statsHtml = `
                    <div class="stat-item">
                        <div class="stat-value">${build.views}</div>
                        <div class="stat-label">Views</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${build.likes}</div>
                        <div class="stat-label">Likes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${build.comments.length}</div>
                        <div class="stat-label">Comments</div>
                    </div>
                `;

                const professions = Object.values(build.professions).join(', ');
                const buildId = `${build.player_name}_${build.character_name}`;

                return `
                    <div class="build-card">
                        <div class="build-header">
                            <h4 class="build-title">${build.character_name}</h4>
                            <div class="build-rankings">
                                ${rankingsHtml}
                            </div>
                        </div>
                        <div class="build-info">
                            <div class="build-info-row">
                                <span class="build-info-label">Player:</span>
                                <span class="build-info-value">${build.player_name}</span>
                            </div>
                            <div class="build-info-row">
                                <span class="build-info-label">Server:</span>
                                <span class="build-info-value">${build.server}</span>
                            </div>
                            <div class="build-info-row">
                                <span class="build-info-label">Faction:</span>
                                <span class="build-info-value">${build.faction}</span>
                            </div>
                            <div class="build-info-row">
                                <span class="build-info-label">Professions:</span>
                                <span class="build-info-value">${professions}</span>
                            </div>
                            <div class="build-info-row">
                                <span class="build-info-label">GCW Rank:</span>
                                <span class="build-info-value">${build.gcw_rank}</span>
                            </div>
                        </div>
                        <div class="build-summary">
                            ${build.build_summary}
                        </div>
                        <div class="build-stats">
                            ${statsHtml}
                        </div>
                        <div class="build-actions">
                            <button class="btn btn-primary btn-sm" onclick="window.location.href='/swgdb_site/pages/builds/${buildId}.html'">
                                <i class="fas fa-eye"></i> View Details
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="likeBuild('${buildId}')">
                                <i class="fas fa-heart"></i> Like
                            </button>
                        </div>
                    </div>
                `;
            }

            getRankingClass(ranking) {
                const classes = {
                    'top_dps': 'ranking-top-dps',
                    'popular_buff_bot': 'ranking-buff-bot',
                    'best_tank': 'ranking-tank',
                    'most_versatile': 'ranking-versatile',
                    'community_choice': 'ranking-community'
                };
                return classes[ranking] || 'ranking-community';
            }

            getRankingText(ranking) {
                const texts = {
                    'top_dps': 'Top DPS',
                    'popular_buff_bot': 'Buff Bot',
                    'best_tank': 'Best Tank',
                    'most_versatile': 'Versatile',
                    'community_choice': 'Community'
                };
                return texts[ranking] || ranking;
            }

            renderPagination() {
                const totalPages = Math.ceil(this.filteredBuilds.length / this.buildsPerPage);
                const pagination = document.getElementById('pagination');
                
                if (totalPages <= 1) {
                    pagination.style.display = 'none';
                    return;
                }

                let paginationHtml = '';
                
                // Previous button
                if (this.currentPage > 1) {
                    paginationHtml += `<a href="#" class="page-link" onclick="buildBrowser.goToPage(${this.currentPage - 1})">Previous</a>`;
                }

                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    if (i === this.currentPage) {
                        paginationHtml += `<a href="#" class="page-link active">${i}</a>`;
                    } else {
                        paginationHtml += `<a href="#" class="page-link" onclick="buildBrowser.goToPage(${i})">${i}</a>`;
                    }
                }

                // Next button
                if (this.currentPage < totalPages) {
                    paginationHtml += `<a href="#" class="page-link" onclick="buildBrowser.goToPage(${this.currentPage + 1})">Next</a>`;
                }

                pagination.innerHTML = paginationHtml;
                pagination.style.display = 'flex';
            }

            goToPage(page) {
                this.currentPage = page;
                this.renderBuilds();
            }

            updateBuildCount() {
                const countElement = document.getElementById('buildCount');
                countElement.textContent = `${this.filteredBuilds.length} builds found`;
            }

            showError(message) {
                const container = document.getElementById('buildsContainer');
                container.innerHTML = `
                    <div class="no-builds">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h4>Error</h4>
                        <p>${message}</p>
                    </div>
                `;
            }
        }

        // Global functions for button actions
        async function likeBuild(buildId) {
            try {
                const response = await fetch(`/api/public-builds/${buildId}/like`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    // Refresh the builds to update like count
                    buildBrowser.loadBuilds();
                } else {
                    alert('Failed to like build: ' + data.error);
                }
            } catch (error) {
                alert('Failed to like build: ' + error.message);
            }
        }

        // Initialize the build browser
        let buildBrowser;
        document.addEventListener('DOMContentLoaded', () => {
            buildBrowser = new BuildBrowser();
        });
    </script>
</body>
</html> 