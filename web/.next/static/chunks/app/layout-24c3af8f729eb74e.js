(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{8156:function(e,t,n){Promise.resolve().then(n.t.bind(n,58131,23)),Promise.resolve().then(n.t.bind(n,93459,23)),Promise.resolve().then(n.t.bind(n,25587,23)),Promise.resolve().then(n.bind(n,46175)),Promise.resolve().then(n.bind(n,10296)),Promise.resolve().then(n.bind(n,45021)),Promise.resolve().then(n.bind(n,82405)),Promise.resolve().then(n.t.bind(n,69268,23))},10296:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return a},a:function(){return u}});var r=n(57437),o=n(2265),c=n(99376),s=n(46175);let i=(0,o.createContext)(void 0);function a(e){let{children:t}=e,[n,a]=(0,o.useState)(null),[u,l]=(0,o.useState)(!0),d=(0,c.useRouter)();(0,o.useEffect)(()=>{f()},[]);let f=async()=>{try{let e=localStorage.getItem("ms11_token");if(!e){l(!1);return}let t=await fetch("/api/auth/verify",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();a({...e,lastLoginAt:new Date(e.lastLoginAt)})}else localStorage.removeItem("ms11_token")}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("ms11_token")}finally{l(!1)}},m=async(e,t)=>{try{l(!0);let n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(n.ok){let e=await n.json();return localStorage.setItem("ms11_token",e.token),a({...e.user,lastLoginAt:new Date}),s.Am.success("Welcome back, ".concat(e.user.username,"!")),d.push("/dashboard"),!0}{let e=await n.json();return s.Am.error(e.message||"Login failed"),!1}}catch(e){return console.error("Login error:",e),s.Am.error("Connection error - please try again"),!1}finally{l(!1)}},h=async e=>{if(n)try{let t={...n.preferences,...e};if((await fetch("/api/auth/preferences",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("ms11_token"))},body:JSON.stringify(t)})).ok)a(e=>e?{...e,preferences:t}:null),s.Am.success("Preferences updated");else throw Error("Failed to update preferences")}catch(e){console.error("Preferences update failed:",e),s.Am.error("Failed to update preferences")}},v=async()=>{await f()};return(0,r.jsx)(i.Provider,{value:{user:n,isLoading:u,isAuthenticated:!!n,login:m,logout:()=>{localStorage.removeItem("ms11_token"),a(null),s.Am.success("Logged out successfully"),d.push("/login")},updatePreferences:h,hasPermission:e=>!!n&&("admin"===n.role||n.permissions.includes(e)),refreshUser:v},children:t})}function u(){let e=(0,o.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},45021:function(e,t,n){"use strict";n.d(t,{QueryProvider:function(){return i}});var r=n(57437),o=n(31800),c=n(29827),s=n(2265);function i(e){let{children:t}=e,[n]=(0,s.useState)(()=>new o.S({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,retry:3,retryDelay:e=>Math.min(1e3*2**e,3e4),refetchOnWindowFocus:!0,refetchOnReconnect:!0,refetchInterval:3e4}}}));return(0,r.jsxs)(c.aH,{client:n,children:[t,!1]})}},82405:function(e,t,n){"use strict";n.d(t,{$q:function(){return l},PF:function(){return d},WebSocketProvider:function(){return a},sO:function(){return u},uS:function(){return f}});var r=n(57437),o=n(2265),c=n(46175);let s=null;{let e=n(12872);s=e.io,e.Socket}let i=(0,o.createContext)(void 0);function a(e){let{children:t}=e,[n,a]=(0,o.useState)(null),[u,l]=(0,o.useState)(!1),[d,f]=(0,o.useState)(null),[m,h]=(0,o.useState)(0),v=(0,o.useRef)(),p=(0,o.useRef)();return(0,o.useEffect)(()=>{if(!s)return;let e=s("ws://localhost:5000",{transports:["websocket","polling"],timeout:2e4,reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:1e4,reconnectionAttempts:5,forceNew:!0});return e.on("connect",()=>{l(!0),h(0),p.current&&clearInterval(p.current),p.current=setInterval(()=>{e.emit("ping",Date.now())},3e4),c.Am.success("Connected to MS11 server",{id:"websocket-connection",duration:3e3})}),e.on("disconnect",e=>{l(!1),p.current&&clearInterval(p.current),"io server disconnect"===e&&c.Am.error("Server disconnected - attempting reconnect...",{id:"websocket-connection"})}),e.on("connect_error",e=>{console.error("❌ WebSocket connection error:",e),h(e=>e+1),m<5?c.Am.error("Connection failed (".concat(m+1,"/5) - retrying..."),{id:"websocket-connection"}):c.Am.error("Unable to connect to MS11 server",{id:"websocket-connection",duration:1e4})}),e.on("reconnect",e=>{c.Am.success("Reconnected to MS11 server",{id:"websocket-connection",duration:2e3})}),e.on("pong",e=>{f(new Date(e))}),e.on("session_update",e=>{}),e.on("mode_execution",e=>{}),e.on("quest_update",e=>{}),e.on("system_alert",e=>{c.Am.error("System Alert: ".concat(e.message),{duration:8e3})}),e.on("performance_metric",e=>{}),a(e),()=>{p.current&&clearInterval(p.current),v.current&&clearTimeout(v.current),e.close()}},[]),(0,r.jsx)(i.Provider,{value:{socket:n,isConnected:u,lastPong:d,reconnectCount:m,sendCommand:e=>{n&&u?n.emit("ms11_command",{...e,timestamp:Date.now(),client_id:n.id}):c.Am.error("Not connected to MS11 server")},subscribeToEvents:(e,t)=>n?(e.forEach(e=>{n.on(e,t)}),()=>{e.forEach(e=>{n.off(e,t)})}):()=>{}},children:t})}function u(){let e=(0,o.useContext)(i);if(void 0===e)throw Error("useWebSocket must be used within a WebSocketProvider");return e}function l(){let{subscribeToEvents:e}=u(),[t,n]=(0,o.useState)(null);return(0,o.useEffect)(()=>e(["session_update"],e=>{n(e)}),[e]),t}function d(){let{subscribeToEvents:e}=u(),[t,n]=(0,o.useState)(null);return(0,o.useEffect)(()=>e(["mode_execution"],e=>{n(e)}),[e]),t}function f(){let{subscribeToEvents:e}=u(),[t,n]=(0,o.useState)([]);return(0,o.useEffect)(()=>e(["performance_metric"],e=>{n(t=>[...t.slice(-49),e])}),[e]),t}},69268:function(){}},function(e){e.O(0,[231,216,744],function(){return e(e.s=8156)}),_N_E=e.O()}]);